"use strict";(self.webpackChunkoctoprint=self.webpackChunkoctoprint||[]).push([[290],{4290:(e,n,l)=>{l.r(n),l.d(n,{default:()=>m});var s=l(5043),i=l(3402),t=l(579);const r=e=>{let{isOpen:n,onClose:l,printers:s,onSelectPrinter:i}=e;return n?(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsx)("button",{className:"modal-close",onClick:l,children:"X"}),(0,t.jsx)("h2",{children:"Select a Printer"}),(0,t.jsx)("div",{className:"printer-list",children:s&&s.length>0?s.map((e=>(0,t.jsxs)("div",{onClick:()=>i(e),className:"printer-item",children:[(0,t.jsx)("h3",{children:e.machineName}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"V\u1eadt li\u1ec7u:"})," ",e.material]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"M\xe0u:"})," ",e.color]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"S\u1ed1 file \u0111ang ch\u1edd:"})," ",e.queueLength]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Lo\u1ea1i m\xe1y:"})," ",e.type]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"T\u1ed1c \u0111\u1ed9:"})," ",e.speed]})]},e._id))):(0,t.jsx)("p",{children:"No printers available"})})]})}):null},c=new i.qw({id:"application-0-lpfzcpx"}),o=e=>{let{printer:n}=e;const[l,i]=(0,s.useState)(!1),[o,a]=(0,s.useState)(null),[d,u]=(0,s.useState)([]),[h,p]=(0,s.useState)(null),[x,j]=(0,s.useState)(0),[g,v]=(0,s.useState)(""),[m,f]=(0,s.useState)(!1);(0,s.useEffect)((()=>{var e,l,s,i;null!==n&&void 0!==n&&n.result&&u((null===n||void 0===n||null===(e=n.result[0])||void 0===e||null===(l=e.public)||void 0===l||null===(s=l.output)||void 0===s||null===(i=s.jsonData)||void 0===i?void 0:i.printer)||[]);"yes"===(null===n||void 0===n?void 0:n.press)&&S()}),[n]);const S=()=>{i(!0)};return(0,t.jsxs)("div",{className:"upload-container",children:[(0,t.jsx)("h2",{children:"Upload G-code File"}),(0,t.jsx)("input",{type:"file",accept:".gcode",onChange:e=>{const n=e.target.files[0];if(n){const e=(n.size/1048576).toFixed(2);e>5?(v("File size exceeds 5MB limit. Please select a smaller file."),p(null),j(0)):(p(n),j(parseFloat(e)),v(""))}}}),h&&(0,t.jsxs)("p",{children:["File size: ",x," MB"]}),(0,t.jsx)("button",{onClick:async()=>{if(h){f(!0);try{const e=c.currentUser;if(!e)return v("User not authenticated"),void f(!1);const n=new FileReader;n.onload=async n=>{const l=n.target.result,s=l.split("\n");let i="Unknown";if(s.length>1){const e=s[1].match(/;TIME:(\d+)/);e&&(i=parseInt(e[1],10))}if(o){const n=o._id,s={fileName:h.name,userId:e.id,fileSize:parseFloat(x),fileContent:l,duration:i,printerId:n},t=await e.functions.uploadGcodeFile(s);t.success?(v("File uploaded successfully"),p(null),j(0),a(null),document.querySelector('input[type="file"]').value=null):(console.log(t.message),v("Error uploading file: "+t.message)),f(!1)}else alert("B\u1ea1n ph\u1ea3i ch\u1ecdn m\xe1y in"),f(!1)},n.readAsText(h)}catch(e){console.error("Error uploading file:",e),v("Error uploading file"),f(!1)}}else v("No file selected")},className:"btn btn-info",disabled:m||!h,children:m?"Uploading...":"Upload"}),g&&(0,t.jsx)("p",{children:g}),(0,t.jsx)(r,{isOpen:l,onClose:()=>{i(!1)},printers:d,onSelectPrinter:e=>{a(e),i(!1)}}),o&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Selected Printer:"}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"T\xean m\xe1y:"})," ",o.machineName]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"V\u1eadt li\u1ec7u:"})," ",o.material]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"M\xe0u:"})," ",o.color]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"File \u0111ang ch\u1edd:"})," ",o.queueLength]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Lo\u1ea1i m\xe1y:"})," ",o.type]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"T\u1ed1c \u0111\u1ed9:"})," ",o.speed]})]})]})};var a=l(6244),d=l(443);const u=new i.qw({id:"application-0-lpfzcpx"}),h=()=>{const[e,n]=(0,s.useState)({}),[l,i]=(0,s.useState)({}),[r,c]=(0,s.useState)(null),[o,h]=(0,s.useState)(null),[p,x]=(0,s.useState)(!0),[j,g]=(0,s.useState)(!1),[v,m]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{try{var e,l,s,t,r,c;const o=await u.currentUser.functions.OrderModule("dong");n(null===(e=o[0])||void 0===e||null===(l=e.public)||void 0===l||null===(s=l.input)||void 0===s?void 0:s.jsonSchema),i(null===(t=o[0])||void 0===t||null===(r=t.public)||void 0===r||null===(c=r.input)||void 0===c?void 0:c.uiSchema)}catch(o){h(o.message)}finally{x(!1)}})()}),[]);return p?(0,t.jsx)("div",{children:"Loading..."}):o?(0,t.jsxs)("div",{children:["Error: ",o]}):(0,t.jsxs)("div",{className:"filter-products",children:[(0,t.jsx)("h3",{children:"Ch\u1ecdn s\u1ea3n ph\u1ea9m"}),(0,t.jsx)(a.Ay,{schema:e,onSubmit:async e=>{let{formData:n}=e;try{var l,s,i;m(n);const e=await u.currentUser.functions.OrderModule(n);c(null===(l=e[0])||void 0===l||null===(s=l.public)||void 0===s||null===(i=s.output)||void 0===i?void 0:i.jsonData),g(!0)}catch(o){h(o.message)}},validator:d.Ay,uiSchema:l}),j&&r&&(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"T\xf4ng gi\xe1:"})," ",r.totalCost.toLocaleString(),"\u0111\u1ed3ng"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Th\u1eddi gian ho\xe0ng th\xe0nh:"})," ",(e=>{const n=Math.floor(e),l=Math.round(24*(e-n));return"".concat(n," days ").concat(l," hours")})(r.totalProductionTime)]}),(0,t.jsx)("p",{children:"B\u1ea1n v\u1eabn mu\u1ed1n mua ch\u1ee9?"}),(0,t.jsx)("button",{onClick:()=>{g(!1),m(null)},children:"Kh\xf4ng"}),(0,t.jsx)("button",{onClick:async()=>{v.userId=u.currentUser.id;try{await u.currentUser.functions.AddToBills(v),alert("\u0110\u1eb7t h\xe0ng th\xe0nh c\xf4ng")}catch(o){console.log(o.error)}g(!1),m(null)},children:"C\xf3"})]})})]})},p=new i.qw({id:"application-0-lpfzcpx"}),x=e=>{let{selectPrinter:n}=e;const[l,i]=(0,s.useState)({}),[r,c]=(0,s.useState)({});(0,s.useEffect)((()=>{o()}),[]);const o=async()=>{try{var e,n,l,s,t,r;const o=await p.currentUser.functions.printerModule("dong");i(null===(e=o[0])||void 0===e||null===(n=e.public)||void 0===n||null===(l=n.input)||void 0===l?void 0:l.jsonSchema),c(null===(s=o[0])||void 0===s||null===(t=s.public)||void 0===t||null===(r=t.input)||void 0===r?void 0:r.uiSchema)}catch(o){console.log(o.error)}};return(0,t.jsxs)("div",{className:"select-printer",children:[(0,t.jsx)("h3",{children:"Ch\u1ecdn m\xe1y in"}),(0,t.jsx)(a.Ay,{schema:l,onSubmit:async e=>{let{formData:l}=e;try{const e=await p.currentUser.functions.printerModule(l);console.log(e);n({result:e,press:"yes"})}catch(s){console.log(s.error)}},validator:d.Ay,uiSchema:r})]})},j=new i.qw({id:"application-0-lpfzcpx"}),g=()=>{const[e,n]=(0,s.useState)([]),[l,i]=(0,s.useState)([]),[r,c]=(0,s.useState)([]),[o,a]=(0,s.useState)(0),[d,u]=(0,s.useState)(0);(0,s.useEffect)((()=>{h()}),[]);const h=async()=>{const e=j.currentUser.id;try{var l,s,t,r,o,a,d,u,h,p,x,g,v,m,f;const S=await j.currentUser.functions.AllBills(e);n((null===(l=S[0])||void 0===l||null===(s=l.public)||void 0===s||null===(t=s.output)||void 0===t||null===(r=t.jsonData)||void 0===r?void 0:r.Bills)||[]),i((null===(o=S[0])||void 0===o||null===(a=o.public)||void 0===a||null===(d=a.output)||void 0===d||null===(u=d.jsonData)||void 0===u?void 0:u.done)||[]),c((null===(h=S[0])||void 0===h||null===(p=h.public)||void 0===p||null===(x=p.output)||void 0===x||null===(g=x.jsonData)||void 0===g?void 0:g.in_progress)||[]),console.log(null===(v=S[0])||void 0===v||null===(m=v.public)||void 0===m||null===(f=m.output)||void 0===f?void 0:f.jsonData)}catch(S){console.log(S.message)}},p=()=>{u((e=>e+1))},x=()=>{u((e=>e>0?e-1:0))},g=async e=>{try{await j.currentUser.functions.Recived(e._id),h()}catch(n){console.log(n.error)}};return(0,t.jsxs)("div",{className:"view-printing-files",children:[(0,t.jsx)("button",{onClick:()=>{a(0),u(0)},children:"Xem \u0111\u01a1n h\xe0ng"}),(0,t.jsx)("button",{onClick:()=>{a(1),u(0)},children:"\u0110\xe3 in xong"}),(0,t.jsx)("button",{onClick:()=>{a(2),u(0)},children:"\u0110ang in"}),(()=>{const n=0===o?e.slice(2*d,2*(d+1)):1===o?l.slice(2*d,2*(d+1)):2===o?r.slice(2*d,2*(d+1)):[];return(0,t.jsxs)("div",{className:"column",children:[(0,t.jsx)("h2",{children:0===o?"\u0110\u01a1n h\xe0ng":1===o?"S\u1ea3n ph\u1ea9m ho\xe0ng th\xe0nh":"Trong qu\xe1 tr\xecnh"}),(0,t.jsx)("div",{className:"item-list",children:n.map(((e,n)=>(0,t.jsxs)("div",{className:"item",children:[0===o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Lo\u1ea1i th\u1ebb: ",e.cardType]}),(0,t.jsxs)("p",{children:["Ch\u1ea5t li\u1ec7u: ",e.material]}),(0,t.jsxs)("p",{children:["C\xf4ng ngh\u1ec7 th\u1ebb: ",e.cardTechnology]}),(0,t.jsxs)("p",{children:["S\u1ed1 l\u01b0\u1ee3ng: ",e.quantity]}),(0,t.jsxs)("p",{children:["Tr\u1ea1ng th\xe1i: ",e.status]}),"\u0110ang chuy\u1ec3n h\xe0ng"===e.status&&(0,t.jsx)("button",{onClick:()=>g(e),children:"\u0110\xe3 nh\u1eadn h\xe0ng"})]}),1===o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["T\xean File: ",e.fileName]}),(0,t.jsxs)("p",{children:["K\xedch th\u01b0\u1edbc: ",e.fileSize," MB"]}),(0,t.jsxs)("p",{children:["Tr\u1ea1ng th\xe1i: ",e.status]}),(0,t.jsxs)("p",{children:["Th\u1eddi gian b\u1eaft \u0111\u1ea7u: ",new Date(e.StartTime).toLocaleString()]}),(0,t.jsxs)("p",{children:["Th\u1eddi giang k\u1ebft th\xfac: ",new Date(e.EndTime).toLocaleString()]}),"\u0110ang chuy\u1ec3n h\xe0ng"===e.status&&(0,t.jsx)("button",{onClick:()=>g(e),children:"\u0110\xe3 nh\u1eadn h\xe0ng"})]}),2===o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{children:["Tr\u1ea1ng th\xe1i: ",e.status]}),(0,t.jsxs)("p",{children:["T\u1ed5ng th\u1eddi gian d\u1ef1 ki\u1ebfn: ",e.duration," gi\xe2y"]}),e.estimatedStartTime&&(0,t.jsxs)("p",{children:["Th\u1eddi giang b\u1eaft \u0111\u1ea7u d\u1ef1 ki\u1ebfn: ",new Date(e.estimatedStartTime).toLocaleString()]}),(0,t.jsxs)("p",{children:["Th\u1eddi giang k\u1ebft th\xfac d\u1ef1 ki\u1ebfn: ",new Date(e.estimatedEndTime).toLocaleString()]})]})]},n)))}),(0,t.jsx)("button",{onClick:x,disabled:0===d,children:"\u25c0"}),(0,t.jsx)("button",{onClick:p,disabled:2*(d+1)>=(0===o?e.length:1===o?l.length:r.length),children:"\u25b6"})]})})()]})},v=new i.qw({id:"application-0-lpfzcpx"}),m=()=>{const[e,n]=(0,s.useState)("");(0,s.useEffect)((()=>{l()}),[]);const l=async()=>{try{var e,n,l;console.log(null===(e=v.currentUser)||void 0===e?void 0:e.accessToken),await(null===(n=v.currentUser)||void 0===n?void 0:n.refreshAccessToken()),v.currentUser&&""!==(null===(l=v.currentUser)||void 0===l?void 0:l.accessToken)||(window.location.href="/octoprint/login")}catch(s){console.log(s.error)}};return(0,t.jsxs)("div",{className:"home-container",children:[(0,t.jsx)(o,{printer:e}),(0,t.jsx)(x,{selectPrinter:e=>{n(e)}}),(0,t.jsx)(g,{}),(0,t.jsx)(h,{})]})}}}]);
//# sourceMappingURL=290.50ed692c.chunk.js.map